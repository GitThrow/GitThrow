<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <title>Workbench</title>
  <link th:replace="user/project/fragment/project-page-content :: project-page-head" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" href="../../../static/css/github-markdown.css" th:href="@{/css/github-markdown.css}"/>
  <link rel="stylesheet" href="../../../static/css/highlight/default.css" th:href="@{/css/highlight/default.css}"/>

  <!-- Select2 -->
  <link rel="stylesheet" href="../../../static/plugins/select2/select2.min.css" th:href="@{/plugins/select2/select2.min.css}">
</head>
<body class="skin-blue">
<div class="wrapper">

  <div th:replace="user/project/fragment/project-page-content :: project-page-topmenu"></div>
  <div th:replace="user/project/fragment/project-page-content :: project-page-sidebar"></div>


  <!-- content -->
  <div class="content-wrapper">

    <!-- コンテンツヘッダ -->
    <section class="content-header">
      <h1>管理者設定</h1>
    </section>

    <!-- メインコンテンツ -->
    <section class="content">


      <!-- ビルド設定 -->
      <div class="box box-info">
        <div class="box-header with-border">
          <h3 class="box-title" id="build-settings">ビルド設定</h3>
        </div>
        <!--/*@thymesVar id="buildSettingsForm" type="net.orekyuu.workbench.controller.view.user.project.ProjectAdminSettingController.BuildSettingsForm"*/-->
        <form action="" method="post" class="form-horizontal" th:object="${buildSettingsForm}" th:action="|@{/project}/${project.id}/admin-settings/build-settings|">
          <div class="box-body">

            <div class="form-group" th:classappend="${#fields.hasErrors('buildCommand')?'has-error':''}">
              <label for="build-command" class="col-sm-3 control-label">ビルドコマンド</label>
              <div class="col-sm-9">
                <textarea id="build-command" cols="30" rows="10" class="form-control" th:field="*{buildCommand}"></textarea>
                <p class="help-block" th:if="${#fields.hasErrors('buildCommand')}" th:errors="*{buildCommand}">エラーメッセージ</p>
              </div>
            </div>

            <div class="form-group" th:classappend="${#fields.hasErrors('artifactPath')?'has-error':''}">
              <label for="artifact-path" class="col-sm-3 control-label">成果物のパス</label>
              <div class="col-sm-9">
                <input type="text" id="artifact-path" class="form-control" th:field="*{artifactPath}"/>
                <p class="help-block" th:if="${#fields.hasErrors('artifactPath')}" th:errors="*{artifactPath}">エラーメッセージ</p>
              </div>
            </div>

            <hr/>

            <div class="form-group" th:classappend="${#fields.hasErrors('testCommand')?'has-error':''}">
              <label for="test-command" class="col-sm-3 control-label">テストコマンド</label>
              <div class="col-sm-9">
                <textarea id="test-command" cols="30" rows="10" class="form-control" th:field="*{testCommand}"></textarea>
                <p class="help-block" th:if="${#fields.hasErrors('testCommand')}" th:errors="*{testCommand}">エラーメッセージ</p>
              </div>
            </div>

            <div class="form-group" th:classappend="${#fields.hasErrors('xmlPath')?'has-error':''}">
              <label for="test-result-path" class="col-sm-3 control-label">テスト結果XMLのパス</label>
              <div class="col-sm-9">
                <input type="text" id="test-result-path" class="form-control" th:field="*{xmlPath}"/>
                <p class="help-block" th:if="${#fields.hasErrors('xmlPath')}" th:errors="*{xmlPath}">エラーメッセージ</p>
              </div>
            </div>
          </div>

          <div>
            <div class="box-footer">
              <button type="submit" class="btn btn-primary pull-right"><i class="fa fa-check"></i><span>OK</span></button>
            </div>
          </div>
        </form>
      </div>

      <!--メンバー設定-->
      <div class="box box-info">
        <div class="box-header with-border">
          <h3 class="box-title">メンバー設定</h3>

          <div class="box-tools pull-right">
            <form th:action="|@{/project/}${projectId}/admin-settings/member/new|" method="post">
              <select class="form-control select2" title="users" id="users" name="newMemberId" style="width: 200px;">
              </select>
              <button type="submit" class="btn btn-primary"><i class="fa fa-check"></i><span>追加</span></button>
            </form>
          </div>
        </div>
        <form th:action="|@{/project/}${projectId}/admin-settings/member/delete|" method="post" class="form-horizontal">
          <div class="box-body">

            <table class="table table-hover">
              <tr>
                <th></th>
                <th>ユーザー名</th>
                <th>ID</th>
                <th></th>
              </tr>
              <tr th:each="user : ${projectMember}">
                <!--/*@thymesVar id="user" type="net.orekyuu.workbench.entity.User"*/-->
                <td><img src="../../../static/img/user2-160x160.jpg" th:src="|@{/user/icon/}${user.id}|" alt="" class="img-circle" width="24"></td>
                <td th:text="${user.name}">おれきゅう</td>
                <td th:text="${user.id}">orekyuu</td>
                <!--管理者は削除できないようにする-->
                <td><!--/*@thymesVar id="project" type="net.orekyuu.workbench.entity.Project"*/-->
                <button type="submit" class="btn btn-danger" name="delete" th:value="${user.id}" th:unless="${project.ownerUserId.equals(user.id)}">削除</button></td>　
              </tr>
            </table>
          </div>
        </form>
      </div>
    </section>
  </div><!-- end content -->


  <div th:replace="user/project/fragment/project-page-content :: project-page-footer"></div>


</div><!-- end wrapper -->
<div th:replace="user/project/fragment/project-page-content :: project-page-script"></div>
<!-- marked.js -->
<script src="../../../static/plugins/marked/marked.min.js" th:src="@{/plugins/marked/marked.min.js}"></script>
<script src="../../../static/js/highlight.pack.js" th:src="@{/js/highlight.pack.js}"></script>

<!-- Select2 -->
<script src="../../../static/plugins/select2/select2.full.min.js" th:src="@{/plugins/select2/select2.full.min.js}"></script>
<script th:inline="javascript">
  $(function () {
    //select2
    $(".select2").select2();

    var projectMember = /*[[${projectMember}]]*/ [];
    var projectMemberIds = _.map(projectMember, function (u) {
      return u.id;
    });

    //users
    var $users = $("#users");
    fetchAllUser().then(function (response) {
      var rejected = _.reject(response.data, function (user) {
        return _.contains(projectMemberIds, user.id);
      });

      var first = false;
      _.forEach(rejected, function (user) {
        var selected = first ? 'selected="selected"' : '';
        first = false;

        var tag = '<option ' + selected + ' value="' + user.id + '">' + user.id + '</option>';
        $users.append(tag);
      });
    });
  });
</script>
</body>
</html>
